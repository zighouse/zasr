# ZAsR Server Default Configuration
# Environment variables are expanded using ${VAR} or $VAR syntax
# Common variables: ${HOME}, ${DEPLOY_DIR}, ${MODELS_DIR}

# Server configuration
server:
  host: "0.0.0.0"
  port: 2026
  max_connections: 8  # Optimized for local/embedded use
  worker_threads: 4

# Audio configuration
audio:
  sample_rate: 16000
  sample_width: 2  # s16le = 2 bytes

# VAD configuration (Silero VAD)
# Required for SenseVoice, optional for streaming-zipformer or streaming-paraformer
vad:
  enabled: true
  model: "${MODELS_DIR}/vad/silero_vad.int8.onnx"
  # Speech probability threshold (0.0-1.0)
  threshold: 0.5
  # Minimum silence duration to treat as speech end (seconds)
  min_silence_duration: 0.1
  # Minimum speech duration to treat as speech start (seconds)
  min_speech_duration: 0.25
  # Maximum speech duration before forced cutoff (seconds)
  max_speech_duration: 8.0

# ASR configuration
asr:
  # Recognizer type: "sense-voice", "streaming-zipformer", or "streaming-paraformer"
  type: "sense-voice"
  num_threads: 2
  use_itn: true

  # SenseVoice models (used when type: "sense-voice")
  # Available models (supports multiple languages):
  #   - sherpa-onnx-sense-voice-zh-en-ja-ko-yue-2024-07-17-int8 (中英日韩粤语, 2024-07)
  #   - sherpa-onnx-sense-voice-zh-en-ja-ko-yue-int8-2025-09-09 (中英日韩粤语, 2025-09, recommended)
  # See: https://k2-fsa.github.io/sherpa/onnx/sense-voice/index.html
  sense_voice:
    model: "${MODELS_DIR}/sense-voice/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-int8-2024-07-17/model.int8.onnx"
    tokens: "${MODELS_DIR}/sense-voice/sherpa-onnx-sense-voice-zh-en-ja-ko-yue-int8-2024-07-17/tokens.txt"

  # Streaming Zipformer models (used when type: "streaming-zipformer")
  # Available models (language-specific):
  #   - Chinese (推荐/Recommended):
  #     * sherpa-onnx-streaming-zipformer-zh-xlarge-int8-2025-06-30
  #     * sherpa-onnx-streaming-zipformer-zh-int8-2025-06-30
  #   - English:
  #     * csukuangfj/sherpa-onnx-streaming-zipformer-en-2023-06-26
  #   - Bilingual (中英):
  #     * sherpa-onnx-streaming-zipformer-bilingual-zh-en-2023-02-20
  #     * sherpa-onnx-streaming-zipformer-small-bilingual-zh-en-2023-02-16
  #   - Other languages: Korean, French, etc.
  # See: https://k2-fsa.github.io/sherpa/onnx/pretrained_models/online-transducer/index.html
  streaming_zipformer:
    encoder: "${MODELS_DIR}/streaming-zipformer/encoder-epoch-99-avg-1.onnx"
    decoder: "${MODELS_DIR}/streaming-zipformer/decoder-epoch-99-avg-1.onnx"
    joiner: "${MODELS_DIR}/streaming-zipformer/joiner-epoch-99-avg-1.onnx"
    tokens: "${MODELS_DIR}/streaming-zipformer/tokens.txt"

  # Streaming Paraformer models (used when type: "streaming-paraformer")
  # Available models:
  #   - Trilingual (中粤英/Chinese-Cantonese-English):
  #     * sherpa-onnx-streaming-paraformer-trilingual-zh-cantonese-en (推荐)
  #   - Bilingual (中英):
  #     * sherpa-onnx-streaming-paraformer-bilingual-zh-en
  # See: https://k2-fsa.github.io/sherpa/onnx/pretrained_models/online-paraformer/index.html
  streaming_paraformer:
    encoder: "${MODELS_DIR}/streaming-paraformer/encoder.int8.onnx"
    decoder: "${MODELS_DIR}/streaming-paraformer/decoder.int8.onnx"
    tokens: "${MODELS_DIR}/streaming-paraformer/tokens.txt"

# Punctuation configuration
punctuation:
  enabled: false
  model: "${MODELS_DIR}/punctuation/sherpa-onnx-punct-ct-transformer-zh-en-vocab272727-2024-04-12/model.onnx"

# Speaker identification configuration
speaker_identification:
  enabled: false
  model: "${MODELS_DIR}/speaker-recognition-models/nemo_en_titanet_small.onnx"
  voice_print_db: "${HOME}/.zasr/voice-prints"
  similarity_threshold: 0.75
  auto_track_new_speakers: true

# Processing configuration
processing:
  vad_window_size_ms: 30  # VAD window size (milliseconds)
  update_interval_ms: 200  # Recognition update interval (milliseconds)
  max_batch_size: 2  # Maximum batch size for recognition (optimized for local use)

# Timeout configuration
timeouts:
  connection: 15  # Connection timeout (seconds)
  recognition: 30  # Recognition timeout (seconds)

# Logging configuration
logging:
  file: ""  # Log file path (empty = stdout)
  level: "info"  # Log level: "debug", "info", "warning", "error"
  data_dir: ""  # Optional: save audio/results directory (empty = disabled)

# Model search paths (used if model paths are relative)
# Models are searched in order: deploy_dir -> ~/.cache/sherpa-onnx -> /usr/local/share/sherpa-onnx
model_paths:
  - "${DEPLOY_DIR}/models"
  - "${HOME}/.cache/sherpa-onnx"
  - "/usr/local/share/sherpa-onnx"
